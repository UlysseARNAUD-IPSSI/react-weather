(this["webpackJsonpreact-weather"]=this["webpackJsonpreact-weather"]||[]).push([[0],{16:function(e,t,n){},17:function(e,t,n){},18:function(e,t,n){},19:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var s=n(0),c=n(2),a=n.n(c),i=n(6),r=n.n(i),o=(n(16),n(3)),u=n(5),l=n(7),d=n(8),p=n(1),h=n(10),y=n(9);n(17),n(18);var g=function(e){var t=e.city;if(!t)return Object(s.jsx)("section",{className:"App-section-result",children:"Nothing to show :("});var n=t.name,c=t.sys,a=t.dt,i=t.weather,r=t.wind,o=t.main,u=c.country,l=o.humidity,d=o.temp,p=new Date(1e3*a),h="".concat(p.getDay(),"/").concat(p.getMonth(),"/").concat(p.getFullYear()),y=null;return i[0]&&(y=i.description),Object(s.jsx)("section",{className:"App-section-result",children:Object(s.jsxs)("article",{children:[Object(s.jsxs)("header",{className:"App-section-result-header",children:[n,", ",u]}),Object(s.jsxs)("section",{children:[Object(s.jsxs)("article",{className:"App-section-result-temperature",children:[d,"\xb0F"]}),Object(s.jsxs)("article",{className:"App-section-result-stats",children:[Object(s.jsxs)("p",{className:"App-section-result-stats-sky",children:[h,Object(s.jsx)("br",{}),y]}),Object(s.jsxs)("p",{className:"App-section-result-stats-wind",children:["Vent: ",r.speed," mph (Angle ",r.deg,"\xb0)"]}),Object(s.jsxs)("p",{className:"App-section-result-stats-humidity",children:["Humidit\xe9: ",l,"%"]})]}),Object(s.jsx)("article",{className:"App-section-result-next_days"})]})]})})};n(19);var v=function(e){var t=e.handleKeyPress,n=void 0===t?function(e){}:t,c=e.handleInput,a=void 0===c?function(e){}:c,i=e.handleSuggestionClick,r=void 0===i?function(e){}:i,u=e.suggestions,l=void 0===u?{}:u,d=e.searchQuery,p=void 0===d?void 0:d;return Object(s.jsx)("section",{className:"App-section-search_bar active",children:Object(s.jsxs)("div",{className:"container",children:[Object(s.jsx)("input",{type:"text",name:"city",id:"city",placeholder:"Enter a city",onInput:a,onKeyPress:n}),Object(s.jsx)("input",{type:"hidden",name:"city_id",id:"city_id"}),Object(s.jsx)("aside",{className:"App-section-search_bar-suggestions",children:0!==Object.keys(l).length?Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)("h2",{children:"Did you mean ?"}),Object(s.jsx)("div",{className:"App-section-search_bar-suggestions-list",children:Object.keys(l).map((function(e){var t=l[e].split(","),n=Object(o.a)(t,2),c=n[0],a=n[1];return Object(s.jsxs)("article",{className:"Suggestion",onClick:r,"data-name":c,"data-country":a,"data-id":e,children:[c,Object(s.jsx)("br",{}),a]},e)}))})]}):p?Object(s.jsxs)("h2",{children:['No cities found for "',p,'"']}):null})]})})},m=function(e){Object(h.a)(n,e);var t=Object(y.a)(n);function n(e){var s;return Object(l.a)(this,n),(s=t.call(this,e)).state={activeSection:"search-bar",searchQuery:void 0,suggestions:{}},s.keymap={},s.handleInput=s.handleInput.bind(Object(p.a)(s)),s.handleKeyPress=s.handleKeyPress.bind(Object(p.a)(s)),s.handleSuggestionClick=s.handleSuggestionClick.bind(Object(p.a)(s)),s.updateSuggestions=s.updateSuggestions.bind(Object(p.a)(s)),s.updateResult=s.updateResult.bind(Object(p.a)(s)),s.updateSearchQuery=s.updateSearchQuery.bind(Object(p.a)(s)),s.toggleCityInput=s.toggleCityInput.bind(Object(p.a)(s)),s.keymap=Object(u.a)(Object(u.a)({},s.keymap),{},{Enter:s.updateResult,"/letter/":s.updateSearchQuery}),s}return Object(d.a)(n,[{key:"componentDidMount",value:function(){n.initializeCitiesIfNotExists(),n.showSection(this.state.activeSection),document.addEventListener("keydown",n.switchToMainSectionWhenEsc,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",n.switchToMainSectionWhenEsc,!1)}},{key:"render",value:function(){var e=this.state,t=e.suggestions,n=e.searchQuery,c=localStorage.getItem("active_city_cache");return c&&(c=JSON.parse(c)),Object(s.jsxs)("div",{className:"App",children:[Object(s.jsx)("header",{className:"App-header",children:"Weather"}),Object(s.jsxs)("section",{className:"App-section",children:[Object(s.jsx)(v,{handleInput:this.handleInput,handleKeyPress:this.handleKeyPress,handleSuggestionClick:this.handleSuggestionClick,suggestions:t,searchQuery:n}),Object(s.jsx)(g,{city:c})]}),Object(s.jsx)("footer",{className:"App-footer",children:"Fait par Ulysse ARNAUD avec ReactJS"})]})}},{key:"handleInput",value:function(e){e.preventDefault(),console.log("handleInput",{event:e}),n.resetInputCityId(),(0,this.keymap["/letter/"])(e)}},{key:"handleKeyPress",value:function(e){console.log("handleKeyPress",{event:e});var t=e.key;if(!1!==this.keymap.hasOwnProperty(t)){var n=this.keymap[t];n&&n(e)}}},{key:"handleSuggestionClick",value:function(e){return e.preventDefault(),this.toggleCityInput(e)}},{key:"updateResult",value:function(e){console.log("App : updateResult",{event:e});var t=n.getInputCityId(),s=n.getInputCity();if(console.log({city:s}),s){console.log({cityId:t});var c=t?n.getCityFromId(t):n.getCityFromName(s);console.log({activeCity:c}),localStorage.setItem("active_city_cache",JSON.stringify(c)),this.forceUpdate(),n.showSection("result")}}},{key:"updateSearchQuery",value:function(e){console.log("App : updateSearchQuery",{event:e});var t=e.target.value;this.setState({searchQuery:t}),this.forceUpdate(),this.updateSuggestions()}},{key:"updateSuggestions",value:function(){var e=this;console.log("App : updateSuggestions");var t={},s=this.state.searchQuery;if(!s)return this.setState({suggestions:t}),void this.forceUpdate();s=s.trim();var c="jQuery191028882251251129487_1605706515334",a="https://openweathermap.org/data/2.5/find?callback=".concat(c,"&q=").concat(s,"&type=like&sort=population&cnt=30&appid=439d4b804bc8187953eb36d2a8c26a02&_=1605706515335");fetch(a).then((function(e){return e.text()})).then((function(e){return e=(e=e.replace(c,"")).substring(1,e.length-1),JSON.parse(e)})).then((function(s){console.log({response:s});s.cod;for(var c=s.count,a=s.list,i=(s.message,0);i<c;i++){var r=a[i];n.pushCity(r);var o=r.id,u=r.name,l=r.sys.country;!0===t.hasOwnProperty(o)&&delete t[o],t[o]="".concat(u,",").concat(l)}e.setState({suggestions:t}),e.forceUpdate()})).catch(console.log)}},{key:"toggleCityInput",value:function(e){var t=e.target.dataset,s=t.id,c=t.name,a=t.country,i="".concat(c,", ").concat(a);n.setInputCity(i),n.setInputCityId(s);var r=i;this.setState({searchQuery:r})}}],[{key:"resetInputCityId",value:function(){document.querySelector('.App-section-search_bar input[name="city_id"]').value=null}},{key:"setInputCityId",value:function(e){document.querySelector('.App-section-search_bar input[name="city_id"]').value=e}},{key:"getInputCityId",value:function(){return document.querySelector('.App-section-search_bar input[name="city_id"]').value}},{key:"resetInputCity",value:function(){document.querySelector('.App-section-search_bar input[name="city"]').value=null}},{key:"setInputCity",value:function(e){document.querySelector('.App-section-search_bar input[name="city"]').value=e.trim()}},{key:"getInputCity",value:function(){return document.querySelector('.App-section-search_bar input[name="city"]').value}},{key:"getCities",value:function(){var e=localStorage.getItem("cities_cache");return e?JSON.parse(e):null}},{key:"getCityFromName",value:function(e){var t=n.getCities(),s=e.split(","),c=Object(o.a)(s,2),a=c[0],i=c[1];console.log({_name:a,_country:i});for(var r=0,u=t.length;r<u;r++){var l=t[r];if(a.trim().toLowerCase()===l.name.trim().toLowerCase()){if(!i)return l;if(i&&i.trim().toLowerCase()===l.sys.country.trim().toLowerCase())return l}}return null}},{key:"getCityFromId",value:function(e){for(var t=n.getCities(),s=0,c=t.length;s<c;s++){var a=t[s];if(parseInt(e)===parseInt(a.id))return a}return null}},{key:"pushCity",value:function(e){for(var t=n.getCities(),s=e.id,c=!1,a=0,i=t.length;a<i;a++){if(s===t[a].id){c=!0,t[a]=e;break}}c||t.push(e),t=JSON.stringify(t),localStorage.setItem("cities_cache",t)}},{key:"initializeCitiesIfNotExists",value:function(){localStorage.getItem("cities_cache")||localStorage.setItem("cities_cache",JSON.stringify([]))}}]),n}(a.a.Component);m.sections={"search-bar":".App-section-search_bar",result:".App-section-result"},m.getSection=function(e){return document.querySelector(m.sections[e])},m.showSection=function(e){for(var t in m.sections){var n="remove";e===t&&(n="add"),m.getSection(t).classList[n]("active")}},m.switchToMainSectionWhenEsc=function(e){27===e.keyCode&&m.showSection("search-bar")};var j=m,b=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,s=t.getFID,c=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),s(e),c(e),a(e),i(e)}))};r.a.render(Object(s.jsx)(a.a.StrictMode,{children:Object(s.jsx)(j,{})}),document.getElementById("root")),b()}},[[20,1,2]]]);
//# sourceMappingURL=main.cc9c1940.chunk.js.map